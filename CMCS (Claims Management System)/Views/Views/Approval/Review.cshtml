@model Claim
@using System.IO
@{
    ViewData["Title"] = "Review Claim " + Model.ClaimID;
    var lecturerName = ViewData["LecturerName"] as string;
    var currentRole = ViewData["CurrentRole"] as string;
}

<h2>Review Claim #@Model.ClaimID</h2>
<hr />

<div class="row">
    <div class="col-md-6">
        <h4>Claim Summary</h4>
        <dl class="row">
            <dt class="col-sm-4">Lecturer</dt>
            <dd class="col-sm-8">@lecturerName</dd>

            <dt class="col-sm-4">Month</dt>
            <dd class="col-sm-8">@Model.Month</dd>

            <dt class="col-sm-4">Hourly Rate</dt>
            <dd class="col-sm-8">R @Model.HourlyRate.ToString("N2")</dd>

            <dt class="col-sm-4">Total Hours</dt>
            <dd class="col-sm-8">@Model.TotalHours</dd>

            <dt class="col-sm-4">Total Amount</dt>
            <dd class="col-sm-8">R @Model.TotalAmount.ToString("N2")</dd>

            <dt class="col-sm-4">Current Status</dt>
            <dd class="col-sm-8"><span class="badge bg-warning">@Model.Status</span></dd>
        </dl>
    </div>
    <div class="col-md-6">
        <h4>Attached Documents</h4>
        @if (Model.Documents == null || !Model.Documents.Any())
        {
            <p>No supporting documents uploaded.</p>
        }
        
    </div>
</div>

<h4 class="mt-4">Detailed Sessions</h4>
<table class="table table-bordered table-sm">
    <thead>
        <tr>
            <th>Date</th>
            <th>Hours Worked</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var detail in Model.ClaimDetails!)
        {
            <tr>
                <td>@detail.Date.ToShortDateString()</td>
                <td>@detail.HoursWorked</td>
                <td>@detail.Description</td>
            </tr>
        }
    </tbody>
</table>

<h4 class="mt-4">Approval History</h4>
@if (Model.Approvals != null && Model.Approvals.Any())
{
    <ul class="list-group mb-4">
        @foreach (var approval in Model.Approvals.OrderByDescending(a => a.Date))
        {
            <li class="list-group-item @(approval.Decision == "Approve" ? "list-group-item-success" : "list-group-item-danger")">
                <strong>@approval.Role (@approval.Decision)</strong> on @approval.Date.ToShortDateString(): @approval.Comments
            </li>
        }
    </ul>
}
else
{
    <p>No approval decisions have been recorded yet.</p>
}


<h4 class="mt-4">Make Decision</h4>
<form asp-action="Decision" method="post">
    <input type="hidden" name="claimId" value="@Model.ClaimID" />
    <div class="form-group mb-3">
        <label for="comments">Comments (Mandatory for Rejection):</label>
        <textarea id="comments" name="comments" class="form-control" rows="3"></textarea>
    </div>

    <div class="btn-group">
        <button type="submit" name="decision" value="Approve" class="btn btn-success btn-lg">Approve Claim</button>
        <button type="submit" name="decision" value="Reject" class="btn btn-danger btn-lg">Reject Claim</button>
    </div>
</form>

<a asp-action="Dashboard" class="btn btn-link mt-3">Back to Dashboard</a>